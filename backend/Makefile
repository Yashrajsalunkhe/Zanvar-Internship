# Makefile for Go Backend

.PHONY: help setup run build test clean deps

# Default target
help:
	@echo "Zanvar Go Backend - Available Commands:"
	@echo ""
	@echo "  make setup    - Install dependencies and setup environment"
	@echo "  make run      - Run the Go server"
	@echo "  make build    - Build production binary"
	@echo "  make test     - Run tests"
	@echo "  make clean    - Clean build artifacts"
	@echo "  make deps     - Download and tidy dependencies"
	@echo ""

# Setup environment and install dependencies
setup:
	@echo "üîß Setting up Go backend..."
	@if [ ! -f .env ]; then cp .env.example .env; echo "üìù Created .env file"; fi
	@mkdir -p uploads generated_charts
	@go mod download
	@go mod tidy
	@echo "‚úÖ Setup complete!"

# Download dependencies
deps:
	@echo "üì¶ Downloading dependencies..."
	@go mod download
	@go mod tidy

# Run the server
run:
	@echo "üöÄ Starting server..."
	@mkdir -p uploads generated_charts
	@go run main.go analyzer.go

# Build production binary
build:
	@echo "üî® Building production binary..."
	@go build -o zanvar-server main.go analyzer.go
	@echo "‚úÖ Binary created: ./zanvar-server"

# Run tests
test:
	@echo "üß™ Running tests..."
	@go test ./... -v

# Clean build artifacts
clean:
	@echo "üßπ Cleaning..."
	@rm -f zanvar-server
	@rm -rf uploads/* generated_charts/*
	@echo "‚úÖ Cleaned!"

# Development mode with auto-reload (requires air)
dev:
	@if command -v air > /dev/null; then \
		air; \
	else \
		echo "‚ö†Ô∏è  'air' not installed. Install with: go install github.com/air-verse/air@latest"; \
		echo "Running without auto-reload..."; \
		make run; \
	fi
